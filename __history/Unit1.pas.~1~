unit Unit1;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls,DxHtmlParser,DxHtmlElement, Grids, ComCtrls, ExtCtrls,
  OleCtrls, SHDocVw;

type
  TForm1 = class(TForm)
    Panel1: TPanel;
    ListView1: TListView;
    Button1: TButton;
    WebBrowser1: TWebBrowser;
    procedure FormCreate(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
  private
    { Private declarations }
  public
    { Public declarations }
    HtmlParser: TDxHtmlParser;
  end;

var
  Form1: TForm1;

implementation
uses MSHTML;
{$R *.dfm}




procedure TForm1.Button1Click(Sender: TObject);
var
  i: Integer;
  Table: TDxWebTable;
  strText,LastStr: string;
  Item: TListItem;
begin
  HtmlParser.HTML := (WebBrowser1.Document as IHTMLDocument2).body.innerHTML;
  ListView1.Clear;
  for i := 0 to HtmlParser.WebTables.Count - 1 do
  begin
    Table := HtmlParser.WebTables.TableByIndex[i];
    strText := Table.innerText;
    if (Table.RowCount > 2) and  (CompareStr(strText,LastStr)<>0) and (Pos('µÿ÷∑£∫',strText) <> 0) and (Pos('” ±‡:',strText)<>0) and (Pos('“∆∂Øª∆“≥:',strText)=0) then
    begin
      Item := ListView1.Items.Add;
      Item.Caption := Table.Cell[0,1];
      Item.SubItems.Add(Table.Cell[0,2]);
      Item.SubItems.Add(Table.Cell[0,3]);          
      LastStr := strText;
    end;
  end;  
end;

procedure TForm1.FormClose(Sender: TObject; var Action: TCloseAction);
begin
  HtmlParser.Free;
end;

procedure TForm1.FormCreate(Sender: TObject);
begin
  HtmlParser := TDxHtmlParser.Create;
  WebBrowser1.Navigate(ExtractFilePath(ParamStr(0))+ 'test.htm');
end;

end.
